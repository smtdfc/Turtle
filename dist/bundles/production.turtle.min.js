!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Turtle={})}(this,(function(t){"use strict";function e(t,e){window.__TURTLE__.dev&&window.dispatchEvent(new CustomEvent("turtledev",{detail:{name:t,data:e}}))}class s extends HTMLElement{constructor(){super(),this.app=null,this.component=null}attach(t,s,n){this.app=t,this.component=n,this.component.parent=s,this.component.contexts.parent=s,this.component.element=this,this.component.app=t,e("COMPONENT_ATTACHED",n)}connectedCallback(){this.component.onInit(),this.component.start(),this.component.onCreate(),this.component.startRender()}disconnectedCallback(){this.component.onDestroy()}}window.customElements.define("turtle-component",s);class n{constructor(t){this.root=t??document.createDocumentFragment(),this.refs={},this.bindings={},this.events={}}addBinding(t,e){this.bindings[t]||(this.bindings[t]=[]),this.bindings[t].push(e)}addRef(t,e){if(this.refs[t])throw new Error("[Turtle Render Error] Multiple elements are assigned the same ref, which is not allowed. Each ref must be unique to a single DOM element.");this.refs[t]=e}getRef(t){const e=this.refs[t];if(!e)throw new Error(`[Turtle Render Error] No ref found with the name: ${t}`);return e}removeRef(t){if(!this.refs[t])throw new Error(`[Turtle Render Error] Cannot remove ref: No ref found with the name: ${t}`);delete this.refs[t]}}class r{#t;constructor(t){if(!t)throw new Error("[Turtle Component Ref Error] An element must be provided.");this.#t=t}get component(){if(!this.#t.component)throw new Error("[Turtle Component Ref Error] The element does not have an associated component.");return this.#t.component.forwardRefs}}function i(t,e){return t.startsWith(e)?t.substring(e.length):null}function a(t,e,s,n){let r=!1;for(let a in o){const h=i(e,a),l=o[null!=h?a:e];if(!l)continue;const u=new l(t,h,s,n);"function"==typeof u.apply&&(u.apply(),r=!0);break}return r}const o={"tevent-":class{constructor(t,e,s,n){this.target=t,this.name=e,this.value=s,this.context=n}apply(){this.context.root[this.value]&&this.target.addEventListener(this.name,this.context.root[this.value].bind(this.context.root))}},"tbind-":class{constructor(t,e,s,n){this.target=t,this.name=e,this.value=s,this.context=n}apply(){this.context.addBinding(this.value,{type:"attribute",name:this.name,state:this.value,target:this.target})}},thtml:class{constructor(t,e,s,n){this.target=t,this.name=e,this.value=s,this.context=n}apply(){this.context.addBinding(this.value,{type:"property",name:"innerHTML",state:this.value,target:this.target})}},ttext:class{constructor(t,e,s,n){this.target=t,this.name=e,this.value=s,this.context=n}apply(){this.context.addBinding(this.value,{type:"property",name:"textContent",state:this.value,target:this.target})}},ref:class{constructor(t,e,s,n){this.target=t,this.name=e,this.value=s,this.context=n}apply(){this.context.addRef(this.value,this.target)}}};function h(t,e,s,n){for(let n of Array.from(e.attributes)){let e=n.name,r=n.value;a(t,e,r,s)||t.setAttribute(e,r)}}function l(t,e,s,n,i){for(let a of Array.from(e.childNodes))if(a.nodeType===Node.TEXT_NODE)t.appendChild(a);else if(a.nodeType===Node.ELEMENT_NODE)if(n.components[a.nodeName]){let e=n.components[a.nodeName],o=document.createElement("turtle-component");o.attach(i,s.root,e),a.getAttribute("ref")&&s.addRef(a.getAttribute("ref"),new r(o)),t.appendChild(o)}else{let e=document.createElement(a.tagName);h(e,a,s),a.childNodes.length>0&&l(e,a,s,n),t.appendChild(e)}}function u(t,e,s=new n,r=null){let i=e.raw,a=e.values,o={components:{}};for(let t=0;t<a.length;t++){let e=`turtle-component-${(Math.floor(999999*Math.random())*Date.now()).toString(16)}`;a[t]&&(a[t]instanceof m?(o.components[e]=a[t],a[t]=e):a[t].instance===m&&(o.components[e]=a[t]({}),a[t]=e))}let h=function(t){let e=(new DOMParser).parseFromString(`<root>${t}</root>`,"text/xml"),s=e.getElementsByTagName("parsererror");if(s.length>0){const t="Rendering error: "+s[0].textContent;throw console.log(t),new Error(t)}return e.getElementsByTagName("root")[0]}(String.raw(i,...a));return l(t,h,s,o,r),t}class c{constructor(t,e,s){this.name=t,this.value=e,this.component=s,this.reactive=!0}get(){return this.value}set(t){return this.value=t,this.component.watchers[this.name]&&this.component.watchers[this.name](t),this.component.reactive&&this.reactive&&this.component.requestUpdate({state:this.name,value:t}),t}sync(t,e){return t.sync(e,this),this}}class p{constructor(){this._bindings={},this._values={},this._events={},this._isLocal=!1}_reactive(t,e){this._bindings[t]||(this._bindings[t]=[]);for(const s of this._bindings[t])s.set(e)}set(t,e){this._values[t]=e,this._reactive(t,e)}get(t){return this._values[t]}sync(t,e){this._bindings[t]||(this._bindings[t]=[]),this._bindings[t].push(e)}on(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)}off(t,e){this._events[t]&&(this._events[t]=this.events[t].filter((t=>t!==e)))}emit(t,e){this._events[t]&&this._events[t].forEach((t=>t(e)))}}class d{constructor(t,e){this.parent=t,this.target=e}get(t,e=!1){return this.target._contexts[t]&&e&&this.target._contexts[t]._isLocal?null:this.target._contexts[t]?this.target._contexts[t]:this.parent?this.parent.contexts.get(t,!0):void 0}use(t,e,s=!1){(this.target._contexts[t]||this.parent&&this.parent.contexts.get(t))&&console.warn(`[Turtle Data Warning] Context key "${t}" already exists. The existing context will be overwritten.`),this.target._contexts[t]=e,this.target._contexts[t]._isLocal=s}}class m{constructor(t){this.parent=null,this.app=null,this.element=null,this.props=t,this.watchers={},this.forwardRefs={},this.states={},this.reactive=!0,this._contexts={},this.contexts=new d(this.parent,this),this.renderContext=new n(this),e("COMPONENT_INIT",this)}useContext(t,e,s=!1){if(!(e instanceof p))throw new Error("[Turtle Data Error] Context must be an instance of TurtleContext");return this.contexts.use(t,e,s),e}getContext(t){return this.contexts.get(t)}get refs(){return this.renderContext.refs}createState(t,e){let s=new c(t,e,this);return this.states[t]=s,s}setState(t,e){this.states[t]||(this.states[t]=new c(t,e,this)),this.states[t].set(e)}getState(t){return this.states[t].get()}state(t){return this.states[t]}html(t,...e){return u(document.createDocumentFragment(),{raw:t,values:e},this.renderContext,this.app)}setupState(){return{}}setupWatcher(){return{}}setupForwardRef(){return{}}onInit(){}onCreate(){}onDestroy(){}onRender(){}onUpdate(t){}template(){}async requestUpdate(t){this._reactive(t),e("COMPONENT_UPDATED",this),this.onUpdate(t)}async requestRender(){let t=this.template();this.element.textContent="",this.element.appendChild(t),e("COMPONENT_RENDERED",this),this.onRender()}_reactive(t){let e=this.renderContext.bindings[t.state];if(e)for(let s of e)"property"===s.type&&(s.target[s.name]=t.value),"attribute"===s.type&&s.target.setAttribute(s.name,t.value)}initStates(t){for(let e in t)this.states[e]=new c(e,t[e],this)}start(){this.forwardRefs=this.setupForwardRef()??{},this.watchers=this.setupWatcher()??{},this.initStates(this.setupState()??{})}startRender(){this.requestRender()}}function g(t){function e(...e){let s=new t(e);return s.props=e,s}return e.instance=m,e}class f extends m{constructor(t){super(t),this.matched=!1}onInit(){const[t]=this.props;Array.isArray(t)?(this.routes={},t.forEach((({component:t,path:e})=>{Array.isArray(e)?e.forEach((e=>this.routes[e]=t)):this.routes[e]=t}))):"object"==typeof t&&(this.routes=t)}active(){if(this.app.router){let t=this.app.router,[e,s]=t.match(Object.keys(this.routes),t.currentPath());e&&!this.matched&&(this.matched=!0,this.element.appendChild(this.html`
          <${this.routes[s]}/>
        `)),e||(this.matched=!1,this.element.textContent="")}}onRender(){this.active(),this.app.router&&this.app.router.on("pagechange",this.active.bind(this))}template(){return this.html``}}const v=g(f);class w{constructor(t,e){this.root=e.element??document.createElement("div"),this._app=t,this._app.modules.push(this),this._app.router=this,this.routes={},this.matched=null,this.url=null,this.params={},this.query=new URLSearchParams,this.events={notallow:[],notfound:[],pagematches:[],pageloaded:[],pagechange:[]}}on(t,e){this.events[t].push(e)}off(t,e){this.events[t].forEach(((s,n)=>{s===e&&this.events[t].splice(n,1)}))}static init(t,e){return new w(t,e)}match(t,e){if(e=new URL(e,window.location.origin).pathname,t){for(let s=0;s<t.length;s++){let n=t[s],r=n.split("/"),i=e.split("/"),a=!0;if(i.length!=r.length)a=!1;else for(let t=0;t<r.length&&(void 0===i[t]&&(a=!1),"*"!=r[t]);t++)":"!=r[t][0]?r[t]!=i[t]&&(a=!1):(r[t].substring(1,r[t].length),i[t]);if(a)return[!0,n]}return[!1,null]}}async matches(t){let e=new URL(t,window.location.origin);t=e.pathname,this.emitEvent("pagechange",this);for(let s=0;s<Object.keys(this.routes).length;s++){let r=Object.keys(this.routes)[s],i=this.routes[r],a=r.split("/"),o=t.split("/"),h=!0,l={};if(o.length!=a.length)h=!1;else for(let c=0;c<a.length&&(void 0===o[c]&&(h=!1),"*"!=a[c]);c++)if(":"!=a[c][0])a[c]!=o[c]&&(h=!1);else{l[a[c].substring(1,a[c].length)]=o[c]}if(h){this.params=l,this.query=e.searchParams,this.matched=r,this.url=t;let p=new Function;if(i.callback&&await i.callback(),i.protect){if(!await i.protect())return void this.triggerError("not_allow")}this.emitEvent("pagematches",this),i.loader&&(p=await i.loader()),i.component&&(p=i.component);let d=this,m=this.root;function g(t,...e){m.textContent="",m.appendChild(u(document.createDocumentFragment(),{raw:t,values:e},new n(d._app),d._app))}return this.emitEvent("pageloaded",this),g`<${p}/>`}}this.triggerError("not_found")}start(){let t=!1,e=window.location.hash;0==e.length?(e="/",window.location="#"):e=e.slice(2),window.addEventListener("hashchange",function(){if(t){let t=window.location.hash;t=0==t.length?"/":t.slice(2),this.matches(t)}}.bind(this)),t=!0,this.matches(e),t=!0}currentPath(){let t=window.location.hash;return t=0==t.length?"/":t.slice(2),t}redirect(t,e=!1){e?(window.history.replaceState(null,null,`./#!${t}`),this.matches(t)):window.location.hash=`!${t}`}emitEvent(t,e){this.events[t].forEach((t=>{t(e)}))}triggerError(t){switch(t){case"not_allow":this.emitEvent("notallow",this);break;case"not_found":this.emitEvent("notfound",this)}}}class b{constructor(t,e){this._module=t,this.element=e,this.events={},this.rules={}}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter((t=>t!==e)))}validate(){const t={},e=[];for(const s in this.rules){const n=this.element.querySelector(s).value,r=this.rules[s];r.validate(n)?t[r.fieldAlias??s]=n:e.push({field:s,messages:r.getErrors()})}e.length>0?this.triggerEvent("error",e):this.triggerEvent("success",t)}triggerEvent(t,e){this.events[t]&&this.events[t].forEach((t=>t(e)))}validateWhenSubmit(t=!0){this.element.addEventListener("submit",function(e){t&&e.preventDefault(),this.validate()}.bind(this))}}class E{constructor(t,e){this._app=t,this._app.modules.push(this),this._app.form=this,this.configs=e}static init(t,e){return new E(t,e)}createFormValidator(t){return new b(this,t)}}function x(t,e=!1,s=!1,n){let r=document;return new Promise(((i,a)=>{(n=r.createElement("script")).type="text/javascript",s&&(n.type="module"),n.async=e,n.onload=function(){i()},n.onerror=function(){a(new Error(`Failed to load script: ${t}`))},n.src=t,r.getElementsByTagName("body")[0].appendChild(n)}))}const _={debounce:function(t,e){let s;return function(...n){s&&clearTimeout(s),s=setTimeout((()=>{t.apply(this,n)}),e)}},throttle:function(t,e){let s,n;return function(...r){const i=this;n?(clearTimeout(s),s=setTimeout((function(){Date.now()-n>=e&&(t.apply(i,r),n=Date.now())}),e-(Date.now()-n))):(t.apply(i,r),n=Date.now())}}};window.__TURTLE__={dev:!1,version:"2.0.0"},window.__TURTLE__.dev=!1,t.TurtleApp=class{constructor(t={}){this.root=null,this.configs=t,this._contexts={},this.modules=[],this.contexts=new d(null,this),e("APP_INIT",this)}useModule(t,e){return t.init(this,e)}getContext(t){return this.contexts.get(t)}useContext(t,e){if(!(e instanceof p))throw new Error("[Turtle Data Error] Context must be an instance of TurtleContext");this.contexts.use(t,e)}attach(t){if(e("APP_ATTACHED",this),!(t instanceof HTMLElement))throw new Error("[Turtle Render Error] Element must be an instance of HTMLElement");this.root=t}render(t,...e){if(!this.root)throw new Error("[Turtle Render Error] Root element is not attached. Please attach a root element before rendering.");this.root.textContent="",this.root.appendChild(u(document.createDocumentFragment(),{raw:t,values:e},new n(this),this))}fragment(t,...e){return u(document.createDocumentFragment(),{raw:t,values:e},new n(this),this)}},t.TurtleComponent=m,t.TurtleComponentElement=s,t.TurtleContext=p,t.TurtleContextManagement=d,t.TurtleFormModule=E,t.TurtleFormModuleValidatorRules=class{constructor(){this.validations=[],this.errors=[],this.fieldAlias=null}alias(t){return this.validations.push({rule:t=>!0}),this.fieldAlias=t,this}isNotNull(){return this.validations.push({rule:t=>null!=t&&""!==t.trim(),errorMessage:"Value cannot be null or empty."}),this}maxLength(t){return this.validations.push({rule:e=>e.length<=t,errorMessage:`Value must be at most ${t} characters long.`}),this}minLength(t){return this.validations.push({rule:e=>e.length>=t,errorMessage:`Value must be at least ${t} characters long.`}),this}containsNumber(){return this.validations.push({rule:t=>/\d/.test(t),errorMessage:"Value must contain at least one number."}),this}containsUppercase(){return this.validations.push({rule:t=>/[A-Z]/.test(t),errorMessage:"Value must contain at least one uppercase letter."}),this}containsLowercase(){return this.validations.push({rule:t=>/[a-z]/.test(t),errorMessage:"Value must contain at least one lowercase letter."}),this}containsSpecialChar(){return this.validations.push({rule:t=>/[!@#$%^&*(),.?":{}|<>]/.test(t),errorMessage:"Value must contain at least one special character."}),this}isEmail(){return this.validations.push({rule:t=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t),errorMessage:"Value must be a valid email address."}),this}isPhoneNumber(){return this.validations.push({rule:t=>/^\+?[1-9]\d{1,14}$/.test(t),errorMessage:"Value must be a valid phone number in international format."}),this}isDate(){return this.validations.push({rule:t=>!isNaN(Date.parse(t)),errorMessage:"Value must be a valid date."}),this}isBefore(t){return this.validations.push({rule:e=>new Date(e)<new Date(t),errorMessage:`Date must be before ${t}.`}),this}isAfter(t){return this.validations.push({rule:e=>new Date(e)>new Date(t),errorMessage:`Date must be after ${t}.`}),this}isInRange(t,e){return this.validations.push({rule:s=>s>=t&&s<=e,errorMessage:`Value must be between ${t} and ${e}.`}),this}matchesRegex(t){return this.validations.push({rule:e=>t.test(e),errorMessage:"Value must match the required pattern."}),this}isAlpha(){return this.validations.push({rule:t=>/^[a-zA-Z]+$/.test(t),errorMessage:"Value must contain only alphabetic characters."}),this}isAlphaNumeric(){return this.validations.push({rule:t=>/^[a-zA-Z0-9]+$/.test(t),errorMessage:"Value must contain only alphanumeric characters."}),this}isNumeric(){return this.validations.push({rule:t=>/^[0-9]+$/.test(t),errorMessage:"Value must contain only numeric characters."}),this}isUrl(){return this.validations.push({rule:t=>/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/.test(t),errorMessage:"Value must be a valid URL."}),this}isEqualTo(t){return this.validations.push({rule:e=>e===t,errorMessage:`Value must be equal to ${t}.`}),this}isNotEqualTo(t){return this.validations.push({rule:e=>e!==t,errorMessage:`Value must not be equal to ${t}.`}),this}startsWith(t){return this.validations.push({rule:e=>e.startsWith(t),errorMessage:`Value must start with '${t}'.`}),this}endsWith(t){return this.validations.push({rule:e=>e.endsWith(t),errorMessage:`Value must end with '${t}'.`}),this}isPositiveNumber(){return this.validations.push({rule:t=>!isNaN(t)&&Number(t)>0,errorMessage:"Value must be a positive number."}),this}isNegativeNumber(){return this.validations.push({rule:t=>!isNaN(t)&&Number(t)<0,errorMessage:"Value must be a negative number."}),this}isInteger(){return this.validations.push({rule:t=>Number.isInteger(Number(t)),errorMessage:"Value must be an integer."}),this}isFloat(){return this.validations.push({rule:t=>!isNaN(t)&&t.toString().includes("."),errorMessage:"Value must be a floating-point number."}),this}validate(t){this.errors=[];for(const e of this.validations)e.rule(t)||this.errors.push(e.errorMessage);return 0===this.errors.length}getErrors(){return this.errors}},t.TurtleRenderData=n,t.TurtleRenderHelper=class{constructor(t,e,s=new n){this.app=t,this.context=s,this.root=e}fragment(t,...e){return u(document.createDocumentFragment(),{raw:t,values:e},this.context,this.app)}render(t,...e){this.root.textContent="",this.root.appendChild(u(document.createDocumentFragment(),{raw:raw,values:e},this.context,this.app))}},t.TurtleRoute=v,t.TurtleRouteComponent=f,t.TurtleRouterModule=w,t.TurtleService=class{constructor(t){this.entity=t,this.methods={},this._contexts={},this.contexts=new d(this.entity,this)}useContext(t,e){if(!(e instanceof p))throw new Error("[Turtle Data Error] Context must be an instance of TurtleContext");this.contexts.set(t,e)}getContext(t){return this.contexts.get(t)}define(t,e){this.methods[t]=e.bind(this)}call(){return this.methods}},t.addScript=x,t.createComponent=g,t.ensureNamespace=async function(t,e,s,n,r=!1,i=!1){if(!(t in e))try{await x(s,n,r)}catch(e){if(i)throw new Error(`Failed to ensure namespace: ${t} - ${e.message}`)}},t.performance=_}));
//# sourceMappingURL=production.turtle.min.js.map
